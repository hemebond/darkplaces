name: CI

on:
  # Run on pushes to tags, the "master" branch, and PR's
  push:
    branches:
      - master
  pull_request:

jobs:
  build:

    runs-on: ubuntu-latest

    container:
      image: debian:latest

    steps:
      # Must install git before checking out the repo otherwise github doesn't fetch the .git directory.
      - name: Install dependencies
        run: |
          apt update
          apt install --yes build-essential libjpeg-dev libsdl2-dev libcurl4-openssl-dev libpng-dev libfreetype-dev libvorbis-dev

      - name: Fetch repository
        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11  # v4.1.1

      - name: Compile DP
        run: |
          # fail if there's any warnings
          export CC="cc -Werror"
          make sdl-release

      - name: Upload Linux artifacts
        uses: actions/upload-artifact@ef09cdac3e2d3e60d8ccadda691f4f1cec5035cb  # v4
        with:
          name: Linux
          path: |
            darkplaces-sdl

